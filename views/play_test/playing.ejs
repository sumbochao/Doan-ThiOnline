<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <link rel="shortcut icon" type="image/png" href="/images/logo-icon.png">
    <link rel="stylesheet" href="/css/danglam.css">
    <script src="/jquery.min.js"></script>
    <link href="/dist/vendors/pace-progress/css/pace.min.css" rel="stylesheet">
    <style>
    .gmoaEx {
    width: 78%;
    position: absolute;
    right: 0;
    }
    .hRRepO{
        width:22%;
    }
    @media (max-width: 1000px){
        .hRRepO{
            display:none;
        }
        .gmoaEx{
            width:100%;
        }
    }
    .iyhlnS{
        height: 100%;
    }
    .wvnXF{
        width: 15px;
        height: 15px;
        font-size: 10px;
        background-color: rgb(9, 132, 227);
        color: rgb(255, 255, 255);
        position: absolute;
        right: 0px;
        bottom: 0px;
        display: flex;
        -webkit-box-pack: center;
        justify-content: center;
        -webkit-box-align: center;
        align-items: center;
    }
    .noidung_cauhoi img{
        max-width:600px;
        max-height:200px;
    }
    img{
            margin-left:10px;
            max-width:400px;
            max-height:60px;
        }
        .Wuuww{
            /* width:100%; */
            /* height:70px; */
        }
        #loader {
            position: absolute;
            left: 50%;
            top: 50%;
            z-index: 1;
            margin: -75px 0 0 -75px;
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 3s linear infinite;
            display:none;
            }
            @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
            }

            @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
            }

        .aq{
            background-color:rgba(92, 112, 128, 0.05);
        }
        .aqt{
            background-color:rgb(9, 132, 227);
            color: rgb(255, 255, 255);        }
        .aqtF{
            color: rgb(255, 255, 255);
            background-color: rgb(235, 92, 85);
        }
        .aqtS{
            color: rgb(255, 255, 255);
            background-color: rgb(46, 204, 113);
        }
        #submitting{
            text-align: center;
            display:none;
        }
</style>
</head>

<body class="">
    <div id="__next" style="width: 1351px; height: 568px; ">
        <div class="play__TestPlayContainerStyle-sc-13ix6g6-0 hRLeVY" style="">
            <div class="style__TestPlayStyle-bng1p4-0 ktDzLV" style="">
                <div class="Header__HeaderStyled-iexuc2-0 dzKktC">
                    <div class="Header__Container-iexuc2-1 jzoEAB">
                        <span class="title"><%-test[0].name%></span>
                        <div onclick = "submit()" class="Header__ButtonGroup-iexuc2-2 bQMvuX">
                            <div class="button__ButtonStyle-ff5vbp-0 hQqled" color="#fff">
                                <span class="bp3-icon bp3-icon-tick-circle" icon="tick-circle">
                                    <svg fill="#fff" data-icon="tick-circle" width="14" height="14" viewBox="0 0 16 16">
                                        <desc>tick-circle</desc>
                                        <path d="M8 16c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm4-11c-.28 0-.53.11-.71.29L7 9.59l-2.29-2.3a1.003 1.003 0 0 0-1.42 1.42l3 3c.18.18.43.29.71.29s.53-.11.71-.29l5-5A1.003 1.003 0 0 0 12 5z" fill-rule="evenodd"></path>
                                    </svg>
                                </span>
                                <div class="clearfix__Clearfix-w9lses-0 nSccW" width="8"></div>
                                <span class="button__Span-ff5vbp-1 dSnLVe">Nộp bài</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix__Clearfix-w9lses-0 evHUKk" height="64"></div>
                <div class="style__Container-bng1p4-2 imYbjB">
                    <div class="table-choose__TableChooseContainer-sc-1enzu2-0 hRRepO">
                        <div class="table-choose__WrapperHeading-sc-1enzu2-1 ciTxed">
                            <span class="bp3-icon bp3-icon-properties" icon="properties">
                                <svg fill="#0984E3" data-icon="properties" width="16" height="16" viewBox="0 0 16 16">
                                    <desc>properties</desc>
                                    <path d="M2 6C.9 6 0 6.9 0 8s.9 2 2 2 2-.9 2-2-.9-2-2-2zm4-3h9c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1s.45 1 1 1zm-4 9c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm13-5H6c-.55 0-1 .45-1 1s.45 1 1 1h9c.55 0 1-.45 1-1s-.45-1-1-1zm0 6H6c-.55 0-1 .45-1 1s.45 1 1 1h9c.55 0 1-.45 1-1s-.45-1-1-1zM2 0C.9 0 0 .9 0 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill-rule="evenodd"></path>
                                </svg>
                            </span>
                            <div class="table-choose__HeadingLine-sc-1enzu2-6 khjZis">Bảng chọn đáp án</div>
                        </div>
                        <div class="table-choose__BoxOverviewContainer-sc-1enzu2-2 jBeozc">
                            <input id="length-question" type="hidden" value="<%- questions.length%>">
                            <% for(let i=0;i< questions.length;i++){%>
                                <a id="q<%= i%>" href="#" class="result cpAZmo"><%= i+1%></a>
                            <%}%>
                        </div>
                    </div>
                    <input type="hidden" id="rules" value="<%- rules%>">
                    <div class="style__MainQuestions-bng1p4-1 gmoaEx">
                        <% for(let i=0;i< questions.length;i++){%>
                        <div id="question_<%= i+1%>" class="style__PlayContestBox-bng1p4-5 iyhlnS">
                                <span class="question">Câu <%= i+1%>: </span>
                            <div class="style__QuestionWrapper-bng1p4-6 QKNEr">
                                <div class="noidung_cauhoi">
                                    <span style="font-family: Bookerly; font-size: 16px;"><%- questions[i].question%></span>
                                </div>
                                <div class="clearfix__Clearfix-w9lses-0 bkPuTF" height="16"></div>
                                <div>
                                    <div class="answer style__Wrapper-fvwsih-2 Wuuww">
                                        <div class="style__AlphaEditorWrapper-fvwsih-3 iwtTFX">
                                            <div class="style__AlphaCheck-fvwsih-4 bCNoNL select">A</div>
                                        </div>
                                        <%- questions[i].A%>
                                    </div>
                                    <div class="answer style__Wrapper-fvwsih-2 Wuuww">
                                        <div class="style__AlphaEditorWrapper-fvwsih-3 iwtTFX">
                                            <div class="style__AlphaCheck-fvwsih-4 bCNoNL select">B</div>
                                        </div>
                                        <%- questions[i].B%>
                                    </div>
                                    <%if(questions[i].C){%>
                                        <div class="answer style__Wrapper-fvwsih-2 Wuuww">
                                                <div class="style__AlphaEditorWrapper-fvwsih-3 iwtTFX">
                                                    <div class="style__AlphaCheck-fvwsih-4 bCNoNL select">C</div>
                                                </div>
                                                <%- questions[i].C%>
                                            </div>
                                        <%}%>
                                        <%if(questions[i].D){%>
                                            <div class="answer style__Wrapper-fvwsih-2 Wuuww">
                                                    <div class="style__AlphaEditorWrapper-fvwsih-3 iwtTFX">
                                                        <div class="style__AlphaCheck-fvwsih-4 bCNoNL select">D</div>
                                                    </div>
                                                    <%- questions[i].D%>
                                                </div>
                                            <%}%>
                                            <%if(questions[i].E){%>
                                                <div class="answer style__Wrapper-fvwsih-2 Wuuww">
                                                        <div class="style__AlphaEditorWrapper-fvwsih-3 iwtTFX">
                                                            <div class="style__AlphaCheck-fvwsih-4 bCNoNL select">E</div>
                                                        </div>
                                                        <%- questions[i].E%>
                                                    </div>
                                                <%}%>
                                                <%if(questions[i].F){%>
                                                    <div class="answer style__Wrapper-fvwsih -2 Wuuww">
                                                            <div class="style__AlphaEditorWrapper-fvwsih-3 iwtTFX">
                                                                <div class="style__AlphaCheck-fvwsih-4 bCNoNL select">F</div>
                                                            </div>
                                                            <%- questions[i].F%>
                                                        </div>
                                                    <%}%>
                                </div>
                            </div>
                        </div>
                        <%} %>
                        <div class="clearfix__Clearfix-w9lses-0 evHUKk" height="64"></div>
                    </div>
                </div>
                <div class="clearfix__Clearfix-w9lses-0 glrdKI" height="56"></div>
                <div class="Footer__FooterStyled-sc-1qk898h-0 jYkqxl">
                    <div class="Footer__Container-sc-1qk898h-1 cvHJwD">
                        <div class="navigation Footer__PrevNavigation-sc-1qk898h-2 gtaSnI">
                            <span class="bp3-icon bp3-icon-chevron-left" icon="chevron-left">
                            </span>
                        </div>
                        <span class="countdown-timer__Timer-sc-1bejikl-0 hrwUug">
                            <span id="time" class="bp3-icon bp3-icon-time" icon="time">
                                <svg fill="#007EE5" data-icon="time" width="14" height="14" viewBox="0 0 16 16">
                                    <desc>time</desc>
                                    <path d="M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm1-6.41V4c0-.55-.45-1-1-1s-1 .45-1 1v4c0 .28.11.53.29.71l2 2a1.003 1.003 0 0 0 1.42-1.42L9 7.59z" fill-rule="evenodd"></path>
                                </svg>
                            </span>
                        <span id="timer">
                                <span id="hours" class="number hours"></span>0:<span id="minutes" class="number minutes"><%- test[0].time%></span>:<span id="seconds" class="number seconds">0</span></span>
                        </span>
                        <div class="navigation Footer__NextNavigation-sc-1qk898h-3 kXekre" style=" color: rgb(0, 126, 229);">
                            <span class="bp3-icon bp3-icon-chevron-right" icon="chevron-right">
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="loader"></div>
    <h1 id="submitting">Đang chấm điểm</h1>
</body>

</html>
<script src="/dist/node_modules/pace-progress/pace.min.js"></script>

<script>
    
const length = document.getElementById('length-question');
const rules = document.getElementById('rules').value;
const selected = Array(parseInt(length.value)).fill(null);
const timeUp = parseInt($('#minutes').html());
function selecting(id,select){
    selected[id] = select;
    $('#q'+id).find('span.wvnXF').remove();
    $('#q'+id).addClass('fqGVVP');
    $('#q'+id).append('<span class="wvnXF">'+select+'</span>');
    $('html,body').animate({
            scrollTop: $("#question_"+(id+2)).offset().top - 50}
    ,'slow');
}
 const dateline = new Date().getTime() + 60*1000* timeUp;
    const timer = setInterval(() => {
        let now = new Date().getTime();
        let distance = dateline - now;
        let hours = Math.floor(distance / (1000 * 60 * 60));
        let minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        let seconds = Math.floor((distance % (1000 * 60)) / 1000);
        $('#hours').html(hours);
        $('#minutes').html(minutes);
        $('#seconds').html(seconds);
        if (distance < 1) {
            clearInterval(timer);
            $('#timer').html("Time Up");
            submitting(timeUp);
        }
    }, 1000);
function submit(){
    if(confirm('Vẫn còn thời gian! Bạn có chắc chắn muốn nộp bài ngay ?')){
        clearInterval(timer);
        submitting(timeUp - parseInt($('#minutes').html()));
    }
}
function submitting(time){
    $('#__next').css('display','none');
    $('#loader').css('display','block');
    $('#submitting').css('display','block');
    setTimeout(function(){
        fetch('./submit', {
            method: 'POST',
            body: JSON.stringify({selected,time,rules}),
            headers:{
                'Content-Type': 'application/json'
            }
            }).then(response => response.json())
            .then(res => {
                if(res.message == "success"){
                    location.href="./histories/" + res.data[0];
                }
                else{
                    alert('Server đang lỗi,thử lại sau!');
                    location.href="/";
                }
            })
            .catch(error => console.error('Error:', error));
    },1000)
}
$(document).ready(()=> {
    $('.answer').click(function(){
        let question = $(this).parents('.iyhlnS').attr('id');
        let select = $(this).find('.select').html();
        let arr = question.split('_');
        let id_question = parseInt(arr[arr.length-1]) -1;
        $(this).parents('.iyhlnS').find('.answer').removeClass('aq');
        $(this).addClass('aq');
        $(this).parents('.iyhlnS').find('.select').removeClass('aqt');
        $(this).find('.select').addClass('aqt');
        selecting(id_question,select);
    });
    $('.result').click(function(){
        let id = parseInt($(this).attr('id').slice(1));
        $('html,body').animate({
            scrollTop: $("#question_"+(id+1)).offset().top - 50}
        ,'slow');
    });
});
</script>